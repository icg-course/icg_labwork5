<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><![endif]-->
  <title>Лабораторная работа 5</title>
  <link rel="stylesheet" href="https://www.x3dom.org/download/x3dom.css" />
  <script src="https://www.x3dom.org/download/x3dom.js"></script>
</head>

<body>
  <input type="button" id="nQQ_s" value="ВКЛЮЧИТЬ / ОСТАНОВИТЬ ПОЛЁТ ГОРШКА" onclick='movegorshok();'
    style="background: #ecc3ec; border: 1px solid rgb(10, 9, 9);border-radius: 5px; margin:15px 0px 0px 70px;">
  </input>

  <body style='width:100%; height:100%; border:0; margin:0; padding:0; background: url("t1.jpg") no-repeat fixed;
  background-size: cover; background-position: center;'></body>

  <X3D width="100vw" height="100vh">
    <Scene>

      <Transform DEF="gorshok" rotation="1 0 0 -1.57">
        <!-- цветок 2-->
        <Transform translation="6 0 0.15">
          <Group DEF="flower">
            <!-- цветок 1-->
            <!-- лепесток 1-->
            <Transform DEF="lepestok" translation="0 0 0">
              <Anchor url="http://botsad-spb.com/" parameter="target='_self'">
                <Shape>
                  <IndexedTriangleStripSet index='0 1 2 3 4 5 6 7 8 9 10 11' solid='false'>
                    <Coordinate point=' 0 0 0, -1.5 4 2, -1 5 1, -1 5 1, 0 6 0.5, 0 0 0,
                              0 6 0.5, 1 5 1, 0 0 0, 1 5 1, 1.5 4 2, 0 0 0'></Coordinate>
                    <ColorRGBA color='1 1 1 1, 0.8 0.5 1 1, 0.6 0.2 0.8 1, 0.6 0.2 0.8 1, 0.8 0.5 1 1, 1 1 1 1,
                            0.6 0.2 0.8 1, 0.8 0.5 1 1, 1 1 1 1, 0.6 0.2 0.8 1, 0.8 0.5 1 1, 1 1 1 1'></ColorRGBA>
                  </IndexedTriangleStripSet>
                </Shape>
              </Anchor>
            </Transform>

            <!-- лепесток 2-->
            <Transform translation="0 0 0" rotation="0 0 1 0.7">
              <Shape USE="lepestok">
              </Shape>
            </Transform>

            <!-- лепесток 3-->
            <Transform translation="0 0 0" rotation="0 0 1 1.4">
              <Shape USE="lepestok">
              </Shape>
            </Transform>


            <!-- лепесток 4-->
            <Transform translation="0 0 0" rotation="0 0 1 2.1">
              <Shape USE="lepestok">
              </Shape>
            </Transform>

            <!-- лепесток 5-->
            <Transform translation="0 0 0" rotation="0 0 1 2.8">
              <Shape USE="lepestok">
              </Shape>
            </Transform>

            <!-- лепесток 6-->
            <Transform translation="0 0 0" rotation="0 0 1 3.5">
              <Shape USE="lepestok">
              </Shape>
            </Transform>

            <!-- лепесток 7-->
            <Transform translation="0 0 0" rotation="0 0 1 4.19">
              <Shape USE="lepestok">
              </Shape>
            </Transform>

            <!-- лепесток 8-->
            <Transform translation="0 0 0" rotation="0 0 1 4.89">
              <Shape USE="lepestok">
              </Shape>
            </Transform>

            <!-- лепесток 9-->
            <Transform translation="0 0 0" rotation="0 0 1 5.59">
              <Shape USE="lepestok">
              </Shape>
            </Transform>

            <!-- пестики -->
                <Shape>
                 <IndexedLineSet coordIndex="0 1 2 1 3 1 4 1 5 1 6 1 7" colorIndex="0 1 0 1 0 1 0 1 0 1 0 1 0"
                colorPerVertex="true">
                <Coordinate point="-1 0 3, 0 0 0, 0 0 3, 1 0 3, -0.5 1 3, 0.5 1 3, -0.5 -1 3, 0.5 -1 3"></Coordinate>
                <Color color="0.5 0 0.5, 0.8 0.5 1"></Color>
              </IndexedLineSet>
            </Shape>

            <!-- лепестки 1,2 внутри -->
            <Shape DEF="lepestokvn">
              <Appearance>
                <Material DEF='Mat'></Material>
              </Appearance>
              <IndexedTriangleSet index='0 1 2 0 3 4' solid='false'>
                <Coordinate point='0 0 0, -3 2 2, -1 3.5 1.85, 3 2 2, 1 3.5 1.85'></Coordinate>
              </IndexedTriangleSet>
            </Shape>

            <!-- лепестки 3,4 внутри -->
            <Transform translation="0 0 0" rotation="0 0 1 3.14">
              <Shape USE="lepestokvn">
              </Shape>
            </Transform>

            <!-- тычинки -->
            <Transform DEF="tichinki">
              <Shape>
                <Appearance>
                  <Material emissiveColor="1 1 1"></Material>
                </Appearance>
                <PointSet>
                  <Coordinate point="-1 0 3, 0 0 0, 0 0 3, 1 0 3, -0.5 1 3, 0.5 1 3, -0.5 -1 3, 0.5 -1 3"></Coordinate>
                </PointSet>
              </Shape>
            </Transform>
            <!-- конец тычинок -->
          </Group>
        </Transform>

        <Transform translation="-6 0 0.15" rotation="0 0 0 0.7">
          <Shape USE="flower">
          </Shape>
        </Transform>

        <!-- почва в горшке -->
        <Transform translation="0 0 -0.2">
          <Transform translation="0 -1 -2">
            <Shape>
              <Appearance>
                <TextureTransform scale="1 2"></TextureTransform>
                <ImageTexture url="gr1.jpg"></ImageTexture>
              </Appearance>
              <IndexedFaceSet ccw="true" solid="false"
                coordIndex="0 4 7 3 -1 5 6 2 1 -1 4 5 6 7 -1 6 7 3 2 -1 2 3 0 1 -1 0 1 5 4 -1">
                <Coordinate point="-7.8 -2.3 2, 7.8 -2.3 2, 6 -1 -4, -6 -1 -4, -7.8 4.3 2, 7.8 4.3 2, 6 3 -4, -6 3 -4">
                </Coordinate>
              </IndexedFaceSet>
            </Shape>
          </Transform>

          <!-- горшок -->
          <Transform translation="0 -1 -2">
            <Shape>
              <Appearance>
                <TextureTransform scale="2 4"></TextureTransform>
                <ImageTexture url="g2.jpg"></ImageTexture>
              </Appearance>
              <IndexedFaceSet ccw="true" solid="false"
                coordIndex="0 4 7 3 -1 5 6 2 1 -1 4 5 6 7 -1 6 7 3 2 -1 2 3 0 1 -1">
                <Coordinate point="-8 -2.5 2.5, 8 -2.5 2.5, 6 -1 -4, -6 -1 -4, -8 4.5 2.5, 8 4.5 2.5, 6 3 -4, -6 3 -4">
                </Coordinate>
              </IndexedFaceSet>
            </Shape>
          </Transform>
        </Transform>
      </Transform>


      <!-- навигация -->
      <Viewpoint DEF='camera' description="Начальный вид" position="0 25 50" orientation="-1 0.2 0.5 0.7"></Viewpoint>

      <!-- движение горшка с цветком -->
      <TimeSensor id='QQ_gorshok' DEF="QQ_gorshok" cycleInterval='5' loop='true'></TimeSensor>
      <positionInterpolator DEF='PosInt' key='0, 0.25, 0.5, 0.75, 1'
        keyValue='-5 -5 0, -5 5 -5, 5 5 -5, 5 -5 5, -5 -5 5'>
      </positionInterpolator>
      <PositionChaser DEF="PosCh" duration="2"></PositionChaser>
      <ROUTE fromNode='QQ_gorshok' fromField='fraction_changed' toNode='PosInt' toField='set_fraction'>
      </ROUTE>
      <ROUTE fromNode="PosInt" fromField="value_changed" toNode="PosCh" toField="set_destination">
      </ROUTE>
      <ROUTE fromNode='PosCh' fromField='value_changed' toNode='gorshok' toField='set_translation'>
      </ROUTE>

      <!-- прокрутка цветков вокруг своей оси -->
      <TimeSensor DEF='TSlepestok' cycleInterval='4' loop='true'></TimeSensor>
      <OrientationInterpolator DEF='OrientInt' key='0 0.5 1' keyValue='0 0 1 0, 0 0 1 -3.14, 0 0 1 -6.28'>
      </OrientationInterpolator>
      <OrientationDamper DEF="OrientD" tau="0.5"></OrientationDamper>
      <ROUTE fromNode='TSlepestok' fromField='fraction_changed' toNode='OrientInt' toField='set_fraction'>
      </ROUTE>
      <ROUTE fromNode='OrientInt' fromField='value_changed' toNode='OrientD' toField='set_destination'>
      </ROUTE>
      <ROUTE fromNode='OrientD' fromField='value_changed' toNode='lepestok' toField='set_rotation'>
      </ROUTE>

      <!-- масштабирование тычинок -->
      <TimeSensor DEF="TStichinki" cycleInterval="2" loop='true'></TimeSensor>
      <PositionInterpolator DEF="PosInt1" key="0, 0.33, 0.66, 1" keyValue="1 1 1, 1.1 1.1 1.1, 1.2 1.2 1.2, 1 1 1">
      </PositionInterpolator>
      <ROUTE fromNode="TStichinki" fromField="fraction_changed" toNode="PosInt1" toField="set_fraction">
      </ROUTE>
      <ROUTE fromNode="PosInt1" fromField="value_changed" toNode="tichinki" toField="set_scale">
      </ROUTE>

      <!-- изменение цвета внутренних лепестков -->
      <TimeSensor DEF='TS' cycleInterval='5' loop='true'></TimeSensor>
      <ColorInterpolator DEF='ColInt' key='0 0.33 0.66 1' keyValue='0.5 0.1 0.3, 0.1 0.1 0.1, 0.1 0 0.1, 0.5 0.1 0.3'>
      </ColorInterpolator>
      <ROUTE fromNode='TS' fromField='fraction_changed' toNode='ColInt' toField='set_fraction'>
      </ROUTE>
      <ROUTE fromNode='ColInt' fromField='value_changed' toNode='Mat' toField='set_diffuseColor'>
      </ROUTE>

      <!-- скрипты на остановку/включение анимации тортика и падение сердечек-->
      <script>

        function movegorshok(what) {
          var button = (what == "gorshok")
            ? document.getElementById("nQQ_gorshok")
            : document.getElementById("nQQ_st");
          var TS = (what == "gorshok")
            ? document.getElementById("QQ_st")
            : document.getElementById("QQ_gorshok");
          var QQ_snabled = TS.getAttribute("enabled");
          if (QQ_snabled == "true") {
            TS.setAttribute("enabled", "false");
            button.value = (what == "gorshok")
              ;
          }
          else {
            TS.setAttribute("enabled", "true");
            button.value = (what == "gorshok")
              ;
          }
        }

      </script>
      <viewpoint id="one" position="0 15 25" orientation="-1 0.2 0.5 0.7" fieldofview="1" description="camera">
      </viewpoint>

      <button onclick="document.getElementById('one').setAttribute('set_bind','true');"
        style="border: none; background: transparent; display: block; float: left; margin:10px 0px 0px 80px">camera
        <br><img src="c.png" width="60" height="60"> </img> </br> </button>



    </Scene>
  </X3D>
</body>

</html>