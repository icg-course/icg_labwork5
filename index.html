<html>
<head>
    <title>Koval A. E. 4842</title>
    <script type='text/javascript' src='http://www.x3dom.org/download/x3dom.js'> </script>
    <link rel='stylesheet' type='text/css' href='http://www.x3dom.org/download/x3dom.css'>
    </link>
    <link rel="stylesheet" href="https://www.x3dom.org/download/dev/x3dom.css" />
    <script src="https://x3dom.org/download/1.8.1/x3dom-full.js"></script>
    <link rel="stylesheet" href="../../css/custom.css" />
    <script src="../../js/custom.js"></script>
    <script>
        numClick = 0;
        var lastPoint = [0, 0, 0];
        function move(point) {
            //Инкременируем клики
            deerMoveChaser.setAttribute('set_destination', point[0] + ' ' + parseFloat(point[1] + 0.01) + ' ' + point[2])
            numClick++;
            countClick.innerHTML = numClick;
            //Рассчитываем поворот
            dx = point[0] - lastPoint[0];
            dz = point[2] - lastPoint[2];
            dz = -dz;//Меняем оси на математические
            alpha = Math.atan(dz / dx);
            alpha += -1.57;//Поправка на меш - поворачиваем на пи/2
            if (dx < 0) {
                alpha += 3.14;
            }
            deer.rotation = "0,1,0," + alpha;
            lastPoint = point;
        }
    </script>
</head>
<body>
    <h1>Koval A. E. 4842</h1>
    Кликов - <span id="countClick">0</span>
    </br></br>
    <x3d width='1024px' height='768px'>
        <scene>
            <positionchaser id="deerMoveChaser" duration="1" initialdestination="1.5 0.3 2.7"></positionchaser>
            <TimeSensor DEF='Time' cycleInterval='5' loop='true'></TimeSensor>
            <ColorInterpolator DEF='ColInt' key='0 0.33 0.66 1' keyValue='1 0 0, 0 1 0, 0 0 1, 1 0 0'>
            </ColorInterpolator>
            <CoordinateInterpolator DEF='CoordInt' key='0 0.2 0.4 0.6 0.8 1'
                keyValue='0 3.65 -3,    0 4.35 -3,  .5 3.75 -3,     .5 4.45 -3,     1 3.65 -3,      1 4.35 -3,      1.5 3.75 -3,    1.5 4.45 -3,    2 4.1 -3,
                          0 3.65 -3,    0 4.35 -3,  .5 3.75 -3,     .5 4.45 -3,     1 3.65 -3,      1 4.35 -3,      1.5 3.75 -3,    1.5 4.45 -3,    2 4.1 -3,
                          0 3.65 -3,    0 4.35 -3,  .5 3.75 -2.05,  .5 4.45 -2.05,  1 3.65 -3,      1 4.35 -3,      1.5 3.75 -3,    1.5 4.45 -3,    2 4.1 -3,
                          0 3.65 -3,    0 4.35 -3,  .5 3.75 -3,     .5 4.45 -3,     1 3.65 -2.05,   1 4.35 -2.05,   1.5 3.75 -3,    1.5 4.45 -3,    2 4.1 -3,
                          0 3.65 -3,    0 4.35 -3,  .5 3.75 -3,     .5 4.45 -3,     1 3.65 -3,      1 4.35 -3,      1.5 3.75 -2.05, 1.5 4.45 -2.05, 2 4.1 -2.05,
                          0 3.65 -3,    0 4.35 -3,  .5 3.75 -3,     .5 4.45 -3,     1 3.65 -3,      1 4.35 -3,      1.5 3.75 -3,    1.5 4.45 -3,    2 4.1 -3'>
            </CoordinateInterpolator>
            <Background backUrl="oboi.jpg" bottomUrl="pol.jpg" frontUrl="oboi.jpg" leftUrl="oboi.jpg"
                rightUrl="oboi.jpg" topUrl="potolok.jpg">
            </Background>
            <Viewpoint position='0 3 15'></Viewpoint>
            <Transform DEF="Sun_transform" translation="0.24 0.54 
0.46" scale="11.6 11.6 11.6" rotation="0 0.7 0.7 3.14">
                <DirectionalLight DEF="Sun" ambientIntensity="1.0000" color="1 1 1" intensity="0.57"
                    direction="0 -1 0" />
            </Transform>
            <Spotlight location="1.5 2 2.7" color="1 1 0" intensity="1" direction="4 3 4" cutOffAngle='.3'
                beamWidth='.3'></Spotlight>
            <PointLight location="0 2 3.5" color="1 0 0" intensity="1" shadowIntensity="0.7" shadowMapSize="512">
            </PointLight>
            <Collision enabled="true">
                <Transform DEF='deer' id="deer" translation="1.5 0.3 2.7" scale=".3 .3 .3" rotation="0 1 0 2">
                    <Inline url="Deer.x3d"></Inline>
                </Transform>
                <Group DEF='eksponat'>
                    <transform DEF="fundament" translation="1 -0.2 1" scale="2.5 0.5 2.5">
                        <shape>
                            <appearance>
                                <material DEF='Mat' diffuseColor='0 0 0'></material>
                            </appearance>
                            <box></box>
                        </shape>
                    </transform>
                    <transform DEF="korpus" translation="1 0.75 1" scale="1 0.75 1">
                        <shape>
                            <appearance>
                                <ImageTexture url="stena.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <box></box>
                        </shape>
                    </transform>
                    <transform DEF="arka" translation="1 0.5 2" scale="0.3 0.5 0.2">
                        <shape>
                        <appearance>
                     <ImageTexture url="bashnya.jpg"></ImageTexture>
                     <TextureTransform center='1,1' scale='2, 2'></TextureTransform>
                            </appearance>
                            <Torus innerRadius=".2" outerRadius="1.7"></Torus>
                        </shape>
                    </transform>
                    <transform DEF="bashnya1" translation="0 1 0" scale="0.2 1 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="stena.jpg"></ImageTexture>
                            </appearance>
                            <Cylinder></Cylinder>
                        </shape>
                    </transform>
                    <transform DEF="bashnya2" translation="0 1 2" scale="0.2 1 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="stena.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <Cylinder></Cylinder>
                        </shape>
                    </transform>
                    <transform DEF="bashnya3" translation="2 1 2" scale="0.2 1 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="stena.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <Cylinder></Cylinder>
                        </shape>
                    </transform>
                    <transform DEF="bashnya4" translation="2 1 0" scale="0.2 1 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="stena.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <Cylinder></Cylinder>
                        </shape>
                    </transform>
                  <transform DEF="bashnya5" translation="1 1.5 1" scale="0.5 1 0.5">
                        <shape>
                            <appearance>
                                <ImageTexture url="stena.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <Cylinder></Cylinder>
                        </shape>
                    </transform>
                    <transform DEF="1" translation="0 2.5 0" scale="0.2 0.5 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="bashnya.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <cone></cone>
                        </shape>
                    </transform>
                    <transform DEF="2" translation="0 2.5 2" scale="0.2 0.5 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="bashnya.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <cone></cone>
                        </shape>
                    </transform>
                    <transform DEF="3" translation="2 2.5 0" scale="0.2 0.5 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="bashnya.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <cone></cone>
                        </shape>
                    </transform>
                    <transform DEF="4" translation="2 2.5 2" scale="0.2 0.5 0.2">
                        <shape>
                            <appearance>
                                <ImageTexture url="bashnya.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <cone></cone>
                        </shape>
                    </transform>
                    <transform DEF="5" translation="1 3 1" scale="0.5 0.5 0.5">
                        <shape>
                            <appearance>
                                <ImageTexture url="bashnya.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </appearance>
                            <cone></cone>
                        </shape>
                    </transform>
                    <transform DEF="krysha" translation="1 1.4 1" scale="1 0.6 1">
                        <shape>
                            <appearance>
                                <ImageTexture url="stena.jpg"></ImageTexture>
                                <TextureTransform scale='3,3'></TextureTransform>
                            </appearance>
                            <sphere></sphere>
                        </shape>
                    </transform>
                    <Anchor url="http://tourpedia.ru/inveraray/" parameter="target='_self'">
                        <transform DEF="text" translation="1 -0.2 3.51" scale="0.5 1 0.5">
                            <shape>
                                <Text string='"Inveraray"' solid='false'>
                                    <FontStyle family="TYPEWRITER" size='1' language='en'></FontStyle>
                                </Text>
                                <Appearance>
                                    <Material DEF='Color'></Material>
                                </Appearance>
                            </shape>
                        </transform>
                    </Anchor>
                    <transform translation="1 -0.2 2.51" scale="0.5 1 0.5">
                        <transform DEF="ploskost" translation="0 -0.51 -3" scale="5 5 5" rotation=" 1 0 0 -1.57">
                            <shape>
                                <appearance>
                                   <ImageTexture url="plane.jpg"></ImageTexture>
                                   <TextureTransform scale='3,3'></TextureTransform>
                                </appearance>
                                <plane solid='false'></plane>
                            </shape>
                        </transform>
                        <transform DEF="drevko" translation="0 3.95 -3" scale=".05 .4 .05">
                            <shape>
                                <appearance>
                                    <ImageTexture url="stena.jpg"></ImageTexture>
                                   <TextureTransform scale='2,2'></TextureTransform>
                                </appearance>
                                <Cylinder></Cylinder>
                            </shape>
                        </transform>
                        <Transform DEF="flag">
                            <Shape>
                                <Appearance>
                                    <Material></Material>
                                </Appearance>
                                <IndexedTriangleStripSet index='0 1 2 3 4 5 6 7 8' solid='false' colorPerVertex='false'>
                                    <Coordinate DEF='Coord'
                                        point='0 3.65 -3, 0 4.35 -3, .5 3.75 -3, .5 4.45 -3, 1 3.65 -3, 1 4.35 -3, 1.5 3.75 -3, 1.5 4.45 -3, 2 4.1 -3'>
                                    </Coordinate>
                                    <ColorRGBA color='1 0 0 .5'></ColorRGBA>
                                </IndexedTriangleStripSet>
                            </Shape>
                        </Transform>
                        <Transform DEF="kupol">
                            <Shape>
                                <IndexedLineSet coordIndex="0 1 2 3 0 -1 2 6 5 1 -1 5 6 7 4 -1 0 4 7 3 -1 4 5 -1"
                                    colorPerVertex="true">
                                    <Coordinate point="-5 -.5 2, 5 -.5 2, 5 -.5 -8, -5 -.5 -8, -5 6 2, 5 6 2, 5 6 -8, -5 6 -8"></Coordinate>
   <Color color="1 0 0, 0 1 0, 0 0 1, 1 0 0, 0 1 0, 0 0 1, 1 0 0, 0 1 0"></Color>
                                </IndexedLineSet>
                            </Shape>
                        </Transform>
                    </Transform>
                    <Transform DEF="grid" onclick="move(event.hitPnt);" translation="-1.5 0 -1.5" scale="1 1 1">
                        <Shape>
                            <ElevationGrid xDimension="6" zDimension="6" xSpacing="1.0" zSpacing="1.0" solid="false"
                                height=".7, .8, 1.5, .9, 1, .9,
             0.301, 0.301, 0.301, 0.301, 0.301, 0.301,
             0.301, 0.301, 0.301, 0.301, 0.301, 0.301,
             0.301, 0.301, 0.301, 0.301, 0.301, 0.301,
             0.301, 0.301, 0.301, 0.301, 0.301, 0.301,
             .5, 0.301, 0.301, 0.4, 0.5, 0.301">
                            </ElevationGrid>
                            <Appearance>
                                <ImageTexture url="trava.jpg"></ImageTexture>
                                <TextureTransform scale='2,2'></TextureTransform>
                            </Appearance>
                        </Shape>
                    </Transform>
                </Group>
            </Collision>
            <ROUTE fromNode='Time' fromField='fraction_changed' 
toNode='ColInt' toField='set_fraction'>
            </ROUTE>
            <ROUTE fromNode='ColInt' fromField='value_changed' 
toNode='Color' toField='set_diffuseColor'>
            </ROUTE>
            <ROUTE fromNode='Time' fromField='fraction_changed' 
toNode='CoordInt' toField='set_fraction'>
            </ROUTE>
            <ROUTE fromNode='CoordInt' fromField='value_changed' 
toNode='Coord' toField='set_point'>
            </ROUTE>
            <ROUTE fromnode="deerMoveChaser" fromfield="value_changed" 
tonode="deer" tofield="set_translation">
            </ROUTE>
        </scene>
    </x3d>
</body>

</html>

