<html>

<head>

    <title>Lab5</title>

    <meta charset = 'utf-8'/>

    <script type='text/javascript' src='https://www.x3dom.org/download/dev/x3dom-full.debug.js'> </script>

    <link rel='stylesheet' type='text/css' href='https://www.x3dom.org/download/dev/x3dom.css'>
    </link>
    <script>
    numClick = 0; 
    var lastPoint = [0, 0, 0]; 
    function move(point) { 
        //Взять позицию курсора мыши и передвинуть на нее стул
        ChairMoveChaser.setAttribute('set_destination', point[0] + ' ' + parseFloat(point[1] + 0.01) + ' ' + point[2]) 
        lastPoint = point; 
    } 
    </script>
   


</head>

<body>


    <h1>M. S. Klykov 4842</h1>
    <x3d width='87em' height='37em'>
        <scene>
           <positionchaser id="ChairMoveChaser" duration = "1" initialdestination= "-0.5 -0.8 3"></positionchaser>
            <!--Задний фон-->
            <background skyAngle='1.5708' skyColor='0.6 0.75 1'></background>
            <!--Пол комнаты-->
            <transform DEF = "Floor" onclick="move(event.hitPnt);" translation="-6 -0.7 -6 " scale = "2 1 2" rotation="0 0 0 0">
                <shape>
                    <appearance>
                        <ImageTexture url="parket.jpg"></ImageTexture>
                    </appearance>
                    <ElevationGrid xDimension="7" zDimension="7"
                    height="0, 0.1, -0.1, -0.1, 0, -0.1, 0.1, 0,
                            0, 0.1, -0.1, -0.1, 0, -0.1, 0.1, 0,
                            0, 0.1, -0.1, -0.1, 0, -0.1, 0.1, 0,
                            0, 0.1, -0.1, -0.1, 0, -0.1, 0.1, 0,
                            0, 0.1, -0.1, -0.1, 0, -0.1, 0.1, 0,
                            0, 0.1, -0.1, -0.1, 0, -0.1, 0.1, 0,
                            0, 0.1, -0.1, -0.1, 0, -0.1, 0.1, 0"
                    xSpacing="1" zSpacing="1" solid="false">
                    </ElevationGrid>
                </shape>
            </transform>
            <!--Текст над монитором-->
            <transform ID="Text" translation="-2.37 3 0">
                <Anchor url="http://guap.ru" parameter="target='_self'">
                <shape>
                    <appearance>
                        <material diffuseColor='1 1 1'></material>
                    </appearance>
                    <text string="Computer"></text>
                </shape>
            </Anchor>
            </transform>
            <transform id = "Table">
            <background color=".1 .1 .1"> </background>
            <!--Ножки стула-->
            <transform DEF="nozkaStolaLeftBack" translation="-1.7 0 -0.2" scale="0.1 0.7 0.1">
                <shape>
                    <appearance>
                        <ImageTexture url="./derevo.png"></ImageTexture>
                    </appearance>
                    <box></box>
                </shape>
            </transform>
            <transform DEF="nozkaStolaRightBack" translation="1.7 0 -0.2" scale="0.1 0.7 0.1">
                <shape>
                    <appearance>
                        <material diffuseColor='#D2691E'></material>
                        <ImageTexture url="./derevo.png"></ImageTexture>
                    </appearance>
                    <box></box>
                </shape>
            </transform>
            <transform DEF="nozkaStolaLeftFront" translation="-1.7 0 1.2" scale="0.1 0.7 0.1">
                <shape>
                    <appearance>
                        <material diffuseColor='#D2691E'></material>
                        <ImageTexture url="./derevo.jpg"></ImageTexture>
                    </appearance>
                    <box></box>
                </shape>
            </transform>
            <transform DEF="nozkaStolaRightFront" translation="1.7 0 1.2" scale="0.1 0.7 0.1">
                <shape>
                    <appearance>
                        <material diffuseColor='#D2691E'></material>
                        <ImageTexture url="./derevo.png"></ImageTexture>
                    </appearance>
                    <box></box>
                </shape>
            </transform>
            <!--Сидушка-->
            <transform DEF="doska" translation="0 0.7 0.5" scale="2 0.1 1">
                <shape>
                    <appearance>
                        <material diffuseColor='#D2691E'></material>
                        <ImageTexture url="./derevo.png"></ImageTexture>
                    </appearance>
                    <box></box>
                </shape>
            </transform>
        </transform>
        <group DEF = "Monitor">
            <!--Подстава для монитора-->
            <transform DEF="stoikaDlyaMonitora" translation="0 .8 0.3" scale="0.4 0.05 0.4" rotation="1 0 0 3.14">
                <shape>
                    <appearance>
                        <material diffuseColor='#E6E6FA'></material>
                    </appearance>
                    <cylinder></cylinder>
                </shape>
            </transform>
            <!--Корпус монитора-->
            <transform DEF="Korpusmonitor" translation="0 1.44 0.3" scale="0.6 0.40 0.03" >
                <shape>
                    <appearance>
                        <material diffuseColor='#E6E6FA'></material>
                    </appearance>
                    <Box></Box>
                </shape>
            </transform>
            <!--Видео на мониторе, видео приклепляется к объекту plane-->
            <transform DEF="videonaMonitore" translation="0 1.44 0.35" scale="0.6 0.40 0.03" >
                <shape>
                    <appearance>                
                        <material diffuseColor='1 1 1'></material>
                    </appearance>
                    <plane></plane>
                </shape>
            </transform>
            <!--Держатель монитора-->
            <transform DEF="nozkaDlyaMonitora" translation="0 0.9 0.3" scale="0.05 0.15 0.05" rotation="1 0 0 3.14">
                <shape>
                    <appearance>
                        <material diffuseColor='1 1 1'></material>
                    </appearance>
                    <Cylinder></Cylinder>
                </shape>
            </transform>
        </group>
        <!--Клавиатура-->
            <transform DEF = "klaviatura" translation = "0  0.8 1.1" scale = "0.7 0.3 0.01" rotation = "1 0 0 -1.57">
                <shape>
                    <appearance>
                        <ImageTexture url="./klava.png"></ImageTexture>
                        </appearance>
                        <Box></Box>
                        </shape>
            </transform>
            <group DEF = "Mouse">
            <!--Основание мышки-->
            <transform DEF = "mouseOsnova" translation = "1.2 0.8 1.1" scale = "0.1 0.01 0.2" rotation = "0 0 0 0">
                <Shape>
                    <Appearance>
                      <Material diffuseColor='#E0FFFF'></Material>
                    </Appearance>
                    <Box></Box> 
                  </Shape>
            </transform>
            <!--Кнопки мышки-->
            <transform DEF = "mouseKnopkaLeft" translation = "1.14 0.8 0.95" scale = "0.05 0.065 0.05" rotation = "0 0 0 0">
                <Shape>
                    <Appearance>
                      <Material diffuseColor='#FF4500'></Material>
                    </Appearance>
                    <Box></Box> 
                  </Shape>
            </transform>
            <transform DEF = "mouseKnopkaRight" translation = "1.26 0.8 0.95" scale = "0.05 0.065 0.05" rotation = "0 0 0 0">
                <Shape>
                    <Appearance>
                      <Material diffuseColor='#FF4500'></Material>
                    </Appearance>
                    <Box></Box> 
                  </Shape>
            </transform>
            <!--Центральная часть мышки-->
            <transform DEF = "mouseCenter" translation = "1.2 0.8 1.15" scale = "0.1 0.06 0.15" rotation = "0 0 0 0">
                <Shape>
                    <Appearance>
                      <Material diffuseColor='#E0FFFF'></Material>
                    </Appearance>
                    <Box></Box> 
                  </Shape>
            </transform>
            <!--Колесико мышки-->
            <transform DEF = "kolesomishi" translation = "1.2 0.85 0.97" scale = "0.04 0.02 0.03" rotation = "0 0 1 1.57">
                <Shape>
                    <Appearance>
                      <Material diffuseColor='#E0FFFF'></Material>
                    </Appearance>
                    <Cylinder></Cylinder> 
                  </Shape>
            </transform>
            </group>
            <!--Левый кусок палатки, coordIndex означает порядок соединения точек, point - координата конкретной точки-->
            <transform DEF = "HutLeft" translation = "1.2 0.8 0.3" scale = "0.3 0.3 0.3">
                <shape>
                    <IndexedFaceSet solid="false" coordIndex="3 2 0 1">
                            <Coordinate point="-2 0 2, -2 0 -2, 0 4 2, 0 4 -2"></Coordinate>
                    </IndexedFaceSet>
                    <appearance>
                        <ImageTexture url="./palatka.jpg" repeatS = "false" repeatT = "false"></ImageTexture>
                    </appearance>
                </shape>
            </transform>
            <!--Правый кусок палатки, coordIndex означает порядок соединения точек, point - координата конкретной точки-->

            <transform DEF = "HutRight" translation = "1.2 0.8 0.3" scale = "0.3 0.3 0.3">
                <shape>
                    <IndexedFaceSet  solid="false" coordIndex="3 2 0 1">
                        <Coordinate point="2 0 2, 2 0 -2,
                                            0 4 2, 0 4 -2"></Coordinate>
                    </IndexedFaceSet> 
                    <appearance>
                        <ImageTexture url="./palatka.jpg" repeatS = "false" repeatT = "false"></ImageTexture>
                        </appearance>
                </shape>
            </transform>
            <!--Куб из линий, coordindex означает порядок построения линий, coordindex - цвет точки-->
            <transform DEF = "Cube" translation="1.2 0.8 0.3">
            <shape>
                <indexedlineset coordindex="0 1 2 3 0 -1 2 6 5 1 -1 5 4 7 6 -1 0 4 7 3 0 -1" colorindex="0 1 2 3 4 -1 5 6 0 1 -1" colorpervertex="true" solid="true" ccw="true" usegeocache="true" lit="true"> 
                  <coordinate point="-0.25 0 0.25, 0.25 0 0.25, 0.25 0 -0.25, -0.25 0 -0.25,
                                     -0.25 0.5 0.25, 0.25 0.5 0.25, 0.25 0.5 -0.25, -0.25 0.5 -0.25"></coordinate>
                  <color color="0 0 1, 0 1 0, 0 1 1, 1 0 0, 1 0 1, 1 1 0, 1 1 1"></color>
                </indexedlineset>
              </shape>
            </transform>
            <!--Стены комнаты-->
            <transform DEF = "Walls" translation="0 -0.7 0">
            <shape>
                  <Extrusion crossSection="
                  -6 -6 
                  -6 6 
                  -2 6 
                  -2 5.7 
                  -5.7 5.7 
                  -5.7 -5.7 
                  5.7 -5.7 
                  5.7 5.7 
                  2 5.7
                  2 6 
                  6 6 
                  6 -6
                  -6 -6"
                  convex="false" spine="0 0 0 0 5 0">
                 </Extrusion>
                 <Appearance>
                    <Material diffuseColor='#FF4500'></Material>
                  </Appearance>
              </shape>
            </transform>
            <Transform ID = "Tea">
            <!--Чайник-->
            <transform id="Chai" translation="-1.5 .9 0.5" scale="0.3 0.3 0.3" rotation="1 0 0 3.14">
                <shape>
                    <appearance>
                        <material id = "ch" diffuseColor='#303030'></material>
                    </appearance>
                    <sphere></sphere>
                </shape>
            </transform>
            <!--Носик чайника-->
            <transform Id="Nosik" translation="-1.5 1.2 0.5" scale="0.1 0.1 0.1 " rotation="0 1 0 1.97">
                <shape>
                    <appearance>
                        <material id ="nos" diffuseColor='#303030'></material>
                    </appearance>
                    <torus innerRadius=".2" outerRadius="1.7"></torus>
                </shape>
            </transform>
            <!--Ручка чайника-->
            <transform id="Ruchka" translation="-1.41 1 0.7" scale="0.05 0.2 0.05" rotation="1 1 0 1" >
                <shape>
                    <appearance>
                        <material id = "ruch" diffuseColor='#303030'></material>
                    </appearance>
                    <cylinder>
                        </cylinder>
                </shape>
            </transform>
            </Transform>
            <!--Кружка-->
            <transform DEF="Krygka" translation="-1.25 .9 1" scale=".1 .15 .1" rotation="0 0 0 0">
                <shape>
                    <appearance>
                        <material DEF = "MaterialKrygka" diffuseColor='#FFFF00'></material>
                    </appearance>
                    <cylinder>
                        </cylinder>
                </shape>
            </transform>
            <group DEF = "Svet">
            <!--Подставка лампы-->
            <transform DEF="stoikaDlyafonar" translation="-0.9 0.8 -0.14" scale="0.3 0.05 0.3" rotation="1 0 0 3.14">
                <shape>
                    <appearance>
                        <material diffuseColor='#E6E6FA'></material>
                    </appearance>
                    <cylinder></cylinder>
                </shape>
            </transform>
            <!--Держатель лампы-->
            <transform DEF="nozkaDlyafonar" translation="-0.9 1.2 -0.14" scale="0.05 0.5 0.05" rotation="1 0 0 3.14">
                <shape>
                    <appearance>
                        <material diffuseColor='#E6E6FA'></material>
                    </appearance>
                    <Cylinder></Cylinder>
                </shape>
            </transform>
            <!--Лампа-->
            <transform id = "Shapka" translation = "-2.1 1.5 -0.55 " scale = "0.8 0.8 0.8">
                <shape>
                    <IndexedTriangleSet index=" 0 1 4 0 3 4 1 2 4 2 3 4" solid="false">
                        <Coordinate point="1 0 0, 2 0 0, 2 0 1, 1 0 1, 1.5 1 0.4"></Coordinate>
                        <ColorRGBA color="0 0 49 83, 0 0 49 83, 0 0 49 83, 0 0 49 83,
                        0 0 49 83, 0 0 49 83, 0 0 49 83, 0 0 49 83, 0 0 49 83, 0 0 49 83, 0 0 49 83, 0 0 49 83"></ColorRGBA>
                       </IndexedTriangleSet>                
                </shape>
            </transform>
            </group>
            <!--Импортированные модели меча-->
            <transform scale = "0.05 0.05 0.05" rotation = "1 0 0 1.57">
            <group def="importModels" >
                <transform ID = "Sword1" translation = "-5 -114 -40">
                    <Inline url='"mymodel.x3d"'></Inline>
                </transform>
                <transform DEF = "Sword2" translation = "5 -114.2 -40" rotation = "0 1 0 -1.57">
                    <Inline url='"mymodel.x3d"'></Inline>
                </transform>
            </group>
            </transform>
            <!--Импортированная модель стула и его размноженные модели атрибутом USE-->
            <Transform ID = "Chair" translation = "-0.5 -0.8 3" scale = "0.05 0.05 0.05" rotation = "0 1 0 1.57">
                <Transform DEF = "RotationgChair">
                <Inline url='"chair.x3d"'>
                </Inline>
                </Transform>
            </Transform>
            <!--Точки наблюдения-->
            <ViewPoint id = "cam1" position='-5 2 5.9' fieldOfView='0.7' orientation = "0 1 0 -0.87" description = 'Основная камера'></ViewPoint>
            <ViewPoint position='-7 5 0' fieldOfView='0.7' orientation = "0 1 0 -1.57" description = 'Камера слева'></ViewPoint>
            <ViewPoint position='7 5 0' fieldOfView='0.7' orientation = "0 1 0 1.57" description = 'Камера справа'></ViewPoint>

            <NavigationInfo headlight="false"></NavigationInfo>
            <!--Направленные источники света-->
            <DirectionalLight id="Sun" direction="0 -0.5 -0.5" global="true" shadowIntensity="0.5" intensity="1">
            </DirectionalLight>
            <DirectionalLight direction="0 -0.5 0.5" global="true" shadowIntensity="0" intensity="0.1"></DirectionalLight>
            <DirectionalLight direction="0.5 -0.5 0.5" global="true" shadowIntensity="0" intensity="0.2"></DirectionalLight>
            <DirectionalLight direction="-0.5 -0.5 -0.5" global="true" shadowIntensity="0" intensity="0.2"></DirectionalLight>
            <PointLight id = "point" location = "-0.9 1.5 -0.15" radius = "1" attenation = "1 1 1"></PointLight>
            <!--Туман-->
            <transform translation = "-5 -114 -40">
                <Fog Color = "0.7 0.75 1" visibilityRange = "100"  fogType = "EXPONENTIAL"></Fog>
            </transform>
            <!--Параметры перемещения пользователя по сцене-->
            <NavigationInfo avatarSize = "0.1 3 0.2" speed = "0.3" type = "WALK"></NavigationInfo>

            <!--Два таймера-->
            <TimeSensor DEF="Time" cycleInterval="5" loop="true"></TimeSensor>
            <TimeSensor id="Time1" cycleInterval="9" loop="true"></TimeSensor>
            <!--Группа анимации передвижения и изменения цвета у кружки-->
            <group DEF = "AnimationKrugka">
                <PositionInterpolator DEF="PosInt" key="0 0.23 0.5 0.75 1" keyValue="-1.25 .9 1, -1.25 .9 1.25, -.8 .9 1.25, -.8 .9 1, -1.25 .9 1"></PositionInterpolator>
                <ColorInterpolator DEF="ColInt" key="0 0.33 0.66 1" keyValue="1 0 0, 0 1 0, 0 0 1, 1 0 0"></ColorInterpolator>  
                    <ROUTE fromNode="Time" fromField="fraction_changed" toNode="PosInt" toField="set_fraction"></ROUTE>
                    <ROUTE fromNode="PosInt" fromField="value_changed" toNode="Krygka" toField="set_translation"></ROUTE>
                    <ROUTE fromNode="Time" fromField="fraction_changed" toNode="ColInt" toField="set_fraction"></ROUTE>
                    <ROUTE fromNode="ColInt" fromField="value_changed" toNode="MaterialKrygka" toField="set_diffuseColor"></ROUTE>
            </group>
            <!--Группа анимаций для вращения стульев-->
            <group DEF = "AnimationChair">
                <OrientationInterpolator def="OrientInt1" key="0 0.5 1" keyvalue=" 0 1 0 1.57, 0 1 0 4.71, 0 1 0 7.85" interpolation="LINEAR"></OrientationInterpolator>
                    <ROUTE fromnode="Time1" fromfield="fraction_changed" tonode="OrientInt1" tofield="set_fraction"></ROUTE>
                    <ROUTE fromnode="OrientInt1" fromfield="value_changed" tonode="Chair" tofield="set_rotation"></ROUTE>
                    <ROUTE fromnode="ChairMoveChaser" fromfield="value_changed" tonode="Chair" tofield="set_translation"></ROUTE>
            </group> 

            <script src = "script.js"></script> 
        </scene>
    </x3d>
</body>
</html>