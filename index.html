<html>
<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Lab6</title>
	<link rel="stylesheet" type="text/css" href="../x3d/x3dom.css" />
	<script type="text/javascript" src="../x3d/x3dom-full.js"></script>
	<script type="text/javascript" src="./Source/jquery-3.3.1.min.js"></script>
</head>

<body>
	<script>
		function lightSwitch(id) {
			var light = document.getElementById(id);
			if (light.getAttribute('on') != 'TRUE')
				light.setAttribute('on', 'TRUE');
			else
				light.setAttribute('on', 'FALSE');
		}

		function headlight() {
			var h = document.getElementById("head");
			if (h.getAttribute('headlight') == 'true')
				h.setAttribute('headlight', 'false');
			else
				h.setAttribute('headlight', 'true');
		}

		$(document).ready(function() {
			// Rotation
			$('#UP').click(function(){
				$('#OrientChaser').attr('set_destination', '1 0 0 -0.4');
			});
			$('#DOWN').click(function(){
				$('#OrientChaser').attr('set_destination', '1 0 0 0.3');
			});
			$('#FRONT').click(function(){
				$('#OrientChaser').attr('set_destination', '0 0 0 0');
			});
			$('#LEFT').click(function(){
				$('#OrientChaser').attr('set_destination', '0 1 0 -0.4');
			});
			$('#RIGHT').click(function(){
				$('#OrientChaser').attr('set_destination', '0 1 0 0.4');
			});
			$('#UPRIGHT').click(function(){
				$('#OrientChaser').attr('set_destination', '-1 1 0 -0.4');
			});
			$('#UPLEFT').click(function(){
				$('#OrientChaser').attr('set_destination', '-1 -1 0 -0.4');
			});
			$('#DOWNRIGHT').click(function(){
				$('#OrientChaser').attr('set_destination', '1 1 0 -0.4');
			});
			$('#DOWNLEFT').click(function(){
				$('#OrientChaser').attr('set_destination', '1 -1 0 -0.4');
			});

			// Translation

			$('#MyButton').click(function(){
				var ans = confirm('Вы нажали на кнопку, центральная тыква будет передвинута, вы действительно этого хотите?');
				if (ans)
					if ($('#PosChaser').attr('set_destination')){
						if ($('#PosChaser').attr('set_destination').split(' ')[1] == '4')
							$('#PosChaser').attr('set_destination', '0 0 0')
						else
							$('#PosChaser').attr('set_destination', '0 4 0');
					} else {
						$('#PosChaser').attr('set_destination', '0 4 0');
					}
			});
			
		});

	</script>
	<div id="content">
		<X3D style="left:0px; top:0px; width:100%; height:100%; border: none;">
			<Scene>
				<navigationInfo id="head" headlight='true' type='"EXAMINE"'></navigationInfo>
				<background skyColor="0 0 0"></background>

				<Viewpoint position="2.17707 16.16816 -51.86298" orientation="0.01655 0.98801 0.15351 3.11421"></Viewpoint>
				<Viewpoint description='FrontRight' position="2 1.7 1.4" orientation="-0.5 0.8 0.23 0.82"></Viewpoint>
				<Viewpoint description='FrontLeft' position="-1 -1.4 1" orientation="0.7 -0.7 0.18 1"></Viewpoint>

				<directionalLight id="directional" direction='0 -1 0' on="TRUE" intensity='2.0' shadowIntensity='0.0'></directionalLight>
				<PointLight id='point' on='TRUE' intensity='0.9000' ambientIntensity='0.0000' color='0.0 0.6 0.0' location='2 10 0.5 ' attenuation='0 0 0' radius='5.0000'> </PointLight>
				<SpotLight id='spot' on="TRUE" beamWidth='0.9' color='0 0 1' cutOffAngle='0.78' location='0 0 12' radius='22'></SpotLight>

				<TimeSensor DEF='Time' cycleInterval='10' loop='true' enabled='true'></TimeSensor>

				<transform id="Pumpkin" DEF="PumpkinOne">
				<transform DEF="Pumpkin">

					<transform translation="0 0 -1">
						<Shape DEF="Front">
							<Appearance>
								<imagetexture url="./Textures/Pumpkin_FRONT.png" repeats="true" repeatt="true">
									<texturetransform scale="1 1"></texturetransform>
								</imagetexture>
							</Appearance>
							<IndexedTriangleStripSet index='2 0 3 1 -1' solid="true">
								<Coordinate point='0 0 0, 0 1 0, 1 0 0, 1 1 0'></Coordinate>
							</IndexedTriangleStripSet>
						</Shape>
					</transform>

					<transform translation="0 0 0" rotation="0 1 0 1.57">
						<Shape DEF="Flant">
							<Appearance>
								<imagetexture url="./Textures/Pumpkin_LEFT.png" repeats="true" repeatt="true">
									<texturetransform scale="1 1"></texturetransform>
								</imagetexture>
							</Appearance>
							<IndexedTriangleStripSet index='2 0 3 1 -1' solid="true">
								<Coordinate point='0 0 0, 0 1 0, 1 0 0, 1 1 0'></Coordinate>
							</IndexedTriangleStripSet>
						</Shape>
					</transform>

					<transform translation="0 0 0" rotation="1 0 0 -1.57">
						<Shape DEF="TOP_BOTTOM">
							<Appearance>
								<imagetexture url="./Textures/Pumpkin_TOP.png" repeats="true" repeatt="true">
									<texturetransform scale="1 1"></texturetransform>
								</imagetexture>
							</Appearance>
							<IndexedTriangleStripSet index='2 0 3 1 -1' solid="true">
								<Coordinate point='0 0 0, 0 1 0, 1 0 0, 1 1 0'>
								</Coordinate>
							</IndexedTriangleStripSet>
						</Shape>
					</transform>

					<transform translation="1 0 -1" rotation="0 1 0 -1.57">
						<Shape USE="Flant"></Shape>
					</transform>

					<transform translation="1 0 0" rotation="0 1 0 3.14">
						<Shape USE="Flant"></Shape>
					</transform>

					<transform translation="0 1 -1" rotation="1 0 0 1.57">
						<Shape USE="TOP_BOTTOM"></Shape>
					</transform>

				</transform>
				</transform>

				<PositionInterpolator DEF='PumpkinTwo_PositionInt' key='0 0.125 0.25 0.375 0.5 0.675 0.75 0.875 1' keyValue='-4.2 1 -4.2, -6 1 0, -4.2 1 4.2, 0 1 6, 4.2 1 4.2,  6 1 0, 4.2 1 -4.2, 0 1 -6, -4.2 1 -4.2'></PositionInterpolator>
				<transform DEF="PumpkinTwo" translation="2 0 2">
					<transform use="Pumpkin">
					</transform>
				</transform>

				<transform translation="-2 -1 -3">
					<Shape>
						<Appearance>
							<imagetexture url="./Textures/SandFloor.jpg" repeats="true" repeatt="true"></imagetexture>
							<TextureTransform scale="3 3" />
						</Appearance>
						<ElevationGrid xDimension="6" zDimension="6" creaseAngle="0.5" height="0.5, 0.5, -0.5, -0.5, 0.5, 0.5,
                  0.5, 0.5, -0.5, -0.5, 0.5, 0.5,
                  -0.5, -0.5, 0.5, 0.5, -0.5, -0.5,
                  -0.5, -0.5, 0.5, 0.5, -0.5, -0.5,
                  0.5, 0.5, -0.5, -0.5, 0.5, 0.5,
                  0.5, 0.5, -0.5, -0.5, 0.5, 0.5" xSpacing="1" zSpacing="1" solid="false">
						</ElevationGrid>
					</Shape>
				</transform>

				<Transform translation="0 -9.0 0" rotation="1 0 0 -1.57">
					<Shape>
						<Appearance>
							<Material diffuseColor="0.7 0.7 0.7"></Material>
						</Appearance>
						<Plane solid="false" size="30 30"></Plane>
					</Shape>
				</Transform>

				<transform rotation="1 0 0 3.14" translation="0 9 0">
					<transform scale="0.5 0.5 0.5" rotation="0 -1 0 0.28" translation="9 5 -0.5">
						<transform rotation="1 0 0 -0.71">
							<shape id="UP">
								<appearance def="StickColor">
									<material diffuseColor="0.8 0.8 0.8" transparency="0.65"></material>
								</appearance>
								<indexedFaceSet def='plane' solid='true' coordIndex='2 0 3 -1 3 0 1 -1'>
									<coordinate point='-1 -1 0 1 -1 0 -1 1 0 1 1 0'></coordinate>
									<normal vector='0 0 1 0 0 1 0 0 1 0 0 1'></normal>
								</indexedFaceSet>
							</shape>
						</transform>

						<transform translation="0 -3.6 0" rotation="1 0 0 0.71">
							<shape id="DOWN">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet use='plane'></indexedFaceSet>
							</shape>
						</transform>

						<transform translation="0 -1.8 0.65">
							<shape id="FRONT">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet use='plane'></indexedFaceSet>
							</shape>
						</transform>

						<transform translation="1.8 -1.8 0" rotation="0 1 0 0.71">
							<shape id="LEFT">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet use='plane'></indexedFaceSet>
							</shape>
						</transform>

						<transform translation="-1.8 -1.8 0" rotation="0 1 0 -0.71">
							<shape id="RIGHT">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet use='plane'></indexedFaceSet>
							</shape>
						</transform>

						<transform translation="1.8 0 0">
							<shape id="DOWNRIGHT">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet def='plane' solid='true' coordIndex='0 1 2 -1'>
									<coordinate point='-0.75 -0.75 0.65, 0.75 -0.75 -0.65, -0.75 0.75 -0.65,'></coordinate>
								</indexedFaceSet>
							</shape>
						</transform>

						<transform translation="-1.8 0 0">
							<shape id="DOWNLEFT">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet def='plane' solid='true' coordIndex='0 1 2 -1'>
									<coordinate point='-0.75 -0.75 -0.65, 0.75 -0.75 0.65, 0.75 0.75 -0.65,'></coordinate>
								</indexedFaceSet>
							</shape>
						</transform>

						<transform translation="-1.8 -3.59 0">
							<shape id="UPLEFT">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet def='plane' solid='true' coordIndex='0 1 2 -1'>
									<coordinate point='-0.75 0.75 -0.65, 0.75 -0.75 -0.65, 0.75 0.75 0.65,'></coordinate>
								</indexedFaceSet>
							</shape>
						</transform>

						<transform translation="1.8 -3.59 0">
							<shape id="UPRIGHT">
								<appearance use="StickColor"></appearance>
								<indexedFaceSet def='plane' solid='true' coordIndex='0 1 2 -1'>
									<coordinate point='-0.75 0.75 0.65, -0.75 -0.75 -0.65, 0.75 0.75 -0.65,'></coordinate>
								</indexedFaceSet>
							</shape>
						</transform>
					</transform>
				</transform>

				<OrientationChaser id='OrientChaser' initialDestination="0 0 0 0" initialValue="0 0 0 0"></OrientationChaser>
				<PositionChaser id='PosChaser' initialDestination="0 0 0" initialValue="0 0 0"></PositionChaser>

				<route fromNode='OrientChaser' fromField='value_changed' toNode='PumpkinOne' toField='rotation'></route>
				<route fromNode='PosChaser' fromField='value_changed' toNode='PumpkinOne' toField='translation'></route>

				<PositionDamper def='PositionDamperPumpkinTwo'></PositionDamper>

				<route fromNode='Time' toNode='PumpkinTwo_PositionInt' fromField='fraction_changed' toField='set_fraction'></route>
				<route fromNode='PumpkinTwo_PositionInt' toNode='PositionDamperPumpkinTwo' fromField='value_changed' toField='set_destination'></route>
				<route fromNode='PositionDamperPumpkinTwo' toNode='PumpkinTwo' fromField='value_changed' toField='translation'></route>

			</Scene>
		</X3D>
		<div id="tools" style="width: 500px;">
			<input type="checkbox" checked="true" onclick="lightSwitch('point')">
			<label>point light</label>
			<input type="checkbox" checked="true" onclick="lightSwitch('spot')">
			<label>spot light</label>
			<input type="checkbox" checked="true" onclick="lightSwitch('directional')">
			<label>directional light</label>
			<input type="checkbox" checked="true" onclick="headlight()">
			<label>headlight</label>
			<input type="button" id="MyButton" value="Кнопка" onclick=""></input>
		</div>
	</div>

</body>
</html>
