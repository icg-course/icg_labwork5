<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<title>Zhitnikov 4541</title>
		<p>Lab#4</p>
		<script type='text/javascript' src='https://www.x3dom.org/download/dev/x3dom-full.js'> </script>
		<link rel='stylesheet' type='text/css' href='https://www.x3dom.org/release/x3dom.css'/>
	</head>
	<body>
	
		<form id='chCol' onsubmit='changeColor()'>
			<p>Type color in HEX or RGB, and push button to change car color!<Br>
			<textarea id="color" name="form" cols="10" rows="1"></textarea></p>
			<p><input  type="submit" value="Push me">
			<input type="reset" value="Clear form"></p>
		</form>	
		
		
		 <x3d showStat='true' showLog='true' x='0px' y='0px' width='1280px' height='720px'> 
			<scene>
				<transform onClick='move(event.hitPnt)' translation="0 0 0" rotation='1 0 0 3.14'>
					<shape>
					   <Appearance>
							<ImageTexture url="plain_texture.png"></ImageTexture>
					   </Appearance>
					   <ElevationGrid xDimension="7" zDimension="6"
							  height="0, 0, 0, 0, 0, 0, 0,
									  0, 0, 0, 0, 0, 0, 0,
									  0, 0, 0, 0, 0, 0, 0,
									  0, 0, 0, 0, 0, 0, 0,
									  0, 0, 0, 0, 0, 0, 0,
									  0, 0, 0, 0, 0, 0, 0"
							  xSpacing="5.0" zSpacing="5.0" solid="false">
					   </ElevationGrid>
					</shape>
				</transform>
				
				<transform DEF='GreenCar' id='Car' translation='14.8 0.5 -22.75' scale='0.5 0.5 0.5' rotation="0 1 0 0.0">
					<Shape>
						<Appearance>
							<Material id='roof' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' 0.8 0.5 -0.7,
											0.8 0.5 0.7,
											-0.8 0.5 -0.7,
											0.8 0.5 0.7,
											-0.8 0.5 0.7,
											-0.8 0.5 -0.7'/>
						</IndexedTriangleSet>
					</Shape>
					
					<!-- Front windshield -->
					<Shape>
						<Appearance>
							<Material id='frontWind' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' -1.2 0 0.7,
											-0.8 0.5 -0.7,
											-1.2 0 -0.7,
											-1.2 0 0.7,
											-0.8 0.5 0.7,
											-0.8 0.5 -0.7'/>
						</IndexedTriangleSet>
					</Shape>
					
					<Shape>
						<Appearance>
							<Material diffuseColor = '0 0 1'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' -1.201 0 0.6,
											-0.801 0.5 -0.6,
											-1.201 0 -0.6,
											-1.201 0 0.6,
											-0.801 0.5 0.6,
											-0.801 0.5 -0.6'/>
						</IndexedTriangleSet>
					</Shape>
					
					<!-- Rear windshield -->
					<Shape>
						<Appearance>
							<Material id='rearWind' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' 1.2 0 0.7,
											0.8 0.5 -0.7,
											1.2 0 -0.7,
											1.2 0 0.7,
											0.8 0.5 0.7,
											0.8 0.5 -0.7'/>
						</IndexedTriangleSet>
					</Shape>
					
					<Shape>
						<Appearance>
							<Material diffuseColor = '0 0 1'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' 1.201 0 0.6,
											0.801 0.5 -0.6,
											1.201 0 -0.6,
											1.201 0 0.6,
											0.801 0.5 0.6,
											0.801 0.5 -0.6'/>
						</IndexedTriangleSet>
					</Shape>
					
					<!-- Hood -->
					<Shape>
						<Appearance>
							<Material id='hood' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' -2.2 0 0.7,
											-1.2 0 0.7,
											-2.2 0 -0.7,
											-1.2 0 0.7,
											-2.2 0 -0.7,
											-1.2 0 -0.7'/>
						</IndexedTriangleSet>
					</Shape>
					
					<!-- Trunk -->
					<Shape>
						<Appearance>
							<Material id='trunk' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' 2.2 0 0.7,
											1.2 0 0.7,
											2.2 0 -0.7,
											1.2 0 0.7,
											2.2 0 -0.7,
											1.2 0 -0.7'/>
						</IndexedTriangleSet>
					</Shape>
					
					<!-- front side -->
					<Shape>
						<Appearance>
							<Material id='frontSide' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' -2.2 -0.5 0.7,
											-2.2 0 0.7,
											-2.2 0 -0.7,
											-2.2 -0.5 0.7,
											-2.2 -0.5 -0.7,
											-2.2 0 -0.7'/>
						</IndexedTriangleSet>
					</Shape>
					<SpotLight color='1 1 0' direction='1 0 0' location='-2.2 -0.3 0.6'  beamWidth='0.6007963' cutOffAngle='0.5707963' intensity='1'></SpotLight>
					
					<!-- rear side -->
					<Shape>
						<Appearance>
							<Material id='rearSide' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedTriangleSet index='0 1 2 3 4 5' solid='false'>
						<Coordinate point=' 2.2 -0.5 0.7,
											2.2 0 0.7,
											2.2 0 -0.7,
											2.2 -0.5 0.7,
											2.2 -0.5 -0.7,
											2.2 0 -0.7'/>
						</IndexedTriangleSet>
						<PointLight id='point' on='TRUE' intensity='0.5' color='#' location='2.2 2.9 0 ' radius='5.0000' ></PointLight> 
					</Shape>

					<!-- LEFT TOP SIDE -->
					
					<Shape>
						<Appearance>
							<Material id='leftTop' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' -1.2 0 0.7,
											1.2 0 0.7,
											0.8 0.5 0.7,
											-0.8 0.5 0.7
													'/>
						</IndexedFaceSet>
					</Shape>
					
					<Shape>
						<Appearance>
							<Material diffuseColor = '0 0 1'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' -0.7 0.1 0.701,
											-0.2 0.1 0.701,
											-0.2 0.4 0.701,
											-0.7 0.4 0.701
													'/>
						</IndexedFaceSet>
					</Shape>
					
					<Shape>
						<Appearance>
							<Material diffuseColor = '0 0 1'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' 0.7 0.1 0.701,
											0.2 0.1 0.701,
											0.2 0.4 0.701,
											0.7 0.4 0.701
													'/>
						</IndexedFaceSet>
					</Shape>
					
					
					<!-- left side -->
					
					<Shape>
						<Appearance>
							<Material id='leftBot' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' -2.2 -0.5 0.7,
											2.2 -0.5 0.7,
											2.2 0 0.7,
											-2.2 0 0.7
													'/>
						</IndexedFaceSet>
					</Shape>
					
					
					<!-- RIGHT TOP SIDE -->
					
					<Shape>
						<Appearance>
							<Material id='rightTop' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' -1.2 0 -0.7,
											1.2 0 -0.7,
											0.8 0.5 -0.7,
											-0.8 0.5 -0.7
													'/>
						</IndexedFaceSet>
					</Shape>
					
					<Shape>
						<Appearance>
							<Material diffuseColor = '0 0 1'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' -0.7 0.1 -0.701,
											-0.2 0.1 -0.701,
											-0.2 0.4 -0.701,
											-0.7 0.4 -0.701
													'/>
						</IndexedFaceSet>
					</Shape>
					
					<Shape>
						<Appearance>
							<Material diffuseColor = '0 0 1'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' 0.7 0.1 -0.701,
											0.2 0.1 -0.701,
											0.2 0.4 -0.701,
											0.7 0.4 -0.701
													'/>
						</IndexedFaceSet>
					</Shape>
					
					<!-- right side -->
					
					<Shape>
						<Appearance>
							<Material id='rightBot' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' -2.2 -0.5 -0.7,
											2.2 -0.5 -0.7,
											2.2 0 -0.7,
											-2.2 0 -0.7
													'/>
						</IndexedFaceSet>
					</Shape>
					
					
					<!-- BOTTOM -->
					
					<Shape>
						<Appearance>
							<Material id='bottom' diffuseColor = '0 1 0'/>
						</Appearance>
						<IndexedFaceSet solid='false'
										coordIndex='0 1 2 3'>
						<Coordinate point=' -2.2 -0.5 0.7,
											2.2 -0.5 0.7,
											2.2 -0.5 -0.7,
											-2.2 -0.5 -0.7
													'/>
						</IndexedFaceSet>
					</Shape>
					
					<!-- Wheels --> 
					<!-- Front left -->
					<transform translation='-1.4 -0.6 0.8'>
						<shape>
							<appearance>
								<material diffuseColor="#000000"></material>
							</appearance>
							<torus innerRadius='0.1' outerRadius='0.3'></torus>
						</shape>
					</transform>
					
					<!-- Front left disk -->
					<transform translation='-1.4 -0.6 0.8' rotation='1 0 0 1.57'>
						<shape>
							<appearance>
								<material diffuseColor="#778899"></material>
							</appearance>
							<cylinder height='0.05' radius='0.2'></cylinder>
						</shape>
					</transform>
					
					<!-- Rear left -->
					
					<transform translation='1.4 -0.6 0.8'>
						<shape>
							<appearance>
								<material diffuseColor="#000000"></material>
							</appearance>
							<torus innerRadius='0.1' outerRadius='0.3'></torus>
						</shape>
					</transform>
					
					<!-- Rear left disk -->
					<transform translation='1.4 -0.6 0.8' rotation='1 0 0 1.57'>
						<shape>
							<appearance>
								<material diffuseColor="#778899"></material>
							</appearance>
							<cylinder height='0.05' radius='0.2'></cylinder>
						</shape>
					</transform>
					
					<!-- Front right -->
					<transform translation='-1.4 -0.6 -0.8'>
						<shape>
							<appearance>
								<material diffuseColor="#000000"></material>
							</appearance>
							<torus innerRadius='0.1' outerRadius='0.3'></torus>
						</shape>
					</transform>
					
					<!-- Front right disk -->
					<transform translation='-1.4 -0.6 -0.8' rotation='1 0 0 1.57'>
						<shape>
							<appearance>
								<material diffuseColor="#778899"></material>
							</appearance>
							<cylinder height='0.05' radius='0.2'></cylinder>
						</shape>
					</transform>
					
					<!-- Rear right -->
					
					<transform translation='1.4 -0.6 -0.8'>
						<shape>
							<appearance>
								<material diffuseColor="#000000"></material>
							</appearance>
							<torus innerRadius='0.1' outerRadius='0.3'></torus>
						</shape>
					</transform>
					
					<!-- Rear right disk -->
					<transform translation='1.4 -0.6 -0.8' rotation='1 0 0 1.57'>
						<shape>
							<appearance>
								<material diffuseColor="#778899"></material>
							</appearance>
							<cylinder height='0.05' radius='0.2'></cylinder>
						</shape>
					</transform>
				</transform>
				
				<Viewpoint position="48.06834 10.22637 -20.00900" orientation="-0.10316 0.99161 0.07789 1.81161" zNear="12.71901" zFar="65.94001" description="defaultX3DViewpointNode"></Viewpoint>
				<Viewpoint position="11.57360 8.97047 -39.70322" orientation="-0.00483 0.99021 0.13949 3.29594" zNear="12.71901" zFar="65.94001" description="defaultX3DViewpointNode"></Viewpoint>
				<Viewpoint position="17.27547 37.10120 -17.98254" orientation="0.05171 0.71414 0.69809 3.17118" zNear="12.71901" zFar="65.94001" description="defaultX3DViewpointNode"></Viewpoint>
				<Viewpoint position="35.51185 8.66921 -37.84252" orientation="0.03288 0.99115 0.12863 2.47942" zNear="12.71901" zFar="65.94001" description="defaultX3DViewpointNode"></Viewpoint>
			
				<positionchaser def="CarChaser" id="CarChaser" duration="1" initialdestination="15 0 -15" initialvalue="0,0,0" value="0,0,0" destination="0,0,0"></positionchaser>
				
				<route fromnode="CarChaser" fromfield="value_changed" tonode="GreenCar" tofield="set_translation"></route>

			</scene> 
		</x3d> 
		<script type="text/javascript">
			function changeColor(){
				color = document.getElementById('textarea').value
				elements = ['roof','frontWind','rearWind','hood','trunk','frontSide','rearSide','leftTop','leftBot','rightTop','rightBot','bottom']
				for(i=0, i < 13, i++){
					document.getElementById(elements[i]).setAttribute('diffuseColor', color)
				}
			}
			var lastPoint = [0, 0, 0];
			numClick = 0;
			function move(point) {
				//Инкременируем клики
				CarChaser.setAttribute('set_destination', point[0] + ' ' + parseFloat(point[1] + 0.7) + ' ' + point[2])
				numClick++;

				//Рассчитываем поворот
				dx = point[0] - lastPoint[0];
				dz = point[2] - lastPoint[2];
				dz = -dz;//Меняем оси на математические
				alpha = Math.atan(dz / dx);
				//alpha += 1.57;//Поправка на меш - поворачиваем на пи/2
				if (dx < 0) {
					alpha += 3.14;
				}
				Car.rotation = "0,1,0," + alpha;

				lastPoint = point;
			}
		</script>
	</body>
</html>