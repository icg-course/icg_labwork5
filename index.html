<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><![endif]-->
    <title>Лабораторная работа 5</title>
    <link rel="stylesheet" href="https://www.x3dom.org/download/x3dom.css" />
    <script src="https://www.x3dom.org/download/x3dom.js"></script>
    <script>
  	function jump()
		{
			var Enable = TS.getAttribute("enabled");
            if (Enable == "true") 
              {  
				var ET = TS.getAttribute("elapsedTime");
				var  time = TS.getAttribute("elapsedTime");
                TS.setAttribute("pauseTime", time-ET); 
                TS.setAttribute("enabled", "false");
                 var ET = TS2.getAttribute("elapsedTime");
				var  time = TS2.getAttribute("elapsedTime");
                TS2.setAttribute("pauseTime", time-ET); 
                TS2.setAttribute("enabled", "false");
                but.value = "Остановить Вагонетку";
              }
            else 
              {     
				TS.setAttribute("pauseTime", 0);     
            	TS2.setAttribute("pauseTime", 0); 
                TS.setAttribute("enabled", "true");
                TS2.setAttribute("enabled", "true");
                but.value = "Остановить Вагонетку";
              }
		}
         function changeSpeed(n)
      {
        document.getElementById("TS").setAttribute("enabled", "false");
        document.getElementById("TS").setAttribute("cycleInterval", 20/n);
        document.getElementById("TS").setAttribute("enabled", "true");
      }
    </script>
</head>
  <body>
      <div style="position: relative;">
          <input type="button" id="but" value="Остановить Вагонетку" onclick="jump();">
          Cкорость вагонетки
          <input type="range" id="sliderShadowIntesity" min="1" max="20" step="1" value="0" onchange="changeSpeed(this.value)"></input>
      </div>
    <X3D>
        <Scene>
            <NavigationInfo speed="20"></NavigationInfo>
            <Viewpoint position='60 10 -10' orientation="0 0.3 0 1.8"></Viewpoint>
            <Background backUrl="sky_all.png" bottomUrl="sky_bot.png"
                        frontUrl="sky_all.png" leftUrl="sky_sun.png"
                        rightUrl="sky_all.png" topUrl="sky_top.png">
            </Background>
            <transform DEF="ender" rotation="0 1 0 3" translation="23 0 0" center="-23 0 0">
                <Shape>
                    <Appearance>
                        <ImageTexture url='body.png'> </ImageTexture>
                        <TextureProperties></TextureProperties>
                    </Appearance>
                    <Box size="1 3 2"></Box>
                </Shape>
                <transform translation="0, 2.4,">

                    <transform translation="0.92, 0,0" scale='0.2 0.1 0.4'>
                        <Shape>
                            <! -- Глаза-->
                            <Appearance>
                                <ImageTexture url='eyes.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                            coordIndex="3 2 1 0 -1  "
                                            colorIndex="0 1 2 3 -1">
                                <Coordinate point="0 2 2, 0 0 2, 0 0 -2, 0 2 -2"></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </transform>

                    <shape>
                        <! -- голова-->
                        <Appearance>
                            <ImageTexture url='head1.png'></ImageTexture>
                            <TextureProperties></TextureProperties>
                        </Appearance>
                        <Box size="1.8 1.8 1.8"></Box>
                    </shape>
                </transform>
                <transform translation="0, -3,-0.5">
                    <shape DEF="leg">
                        <! -- нога 1-->
                        <Appearance>
                            <ImageTexture url='leg.png'></ImageTexture>
                            <TextureProperties></TextureProperties>
                        </Appearance>
                        <Box size="0.4 6 0.4"></Box>
                    </shape>
                </transform>
                <transform translation="0, -3,0.5">
                    <shape USE="leg">
                        <! -- нога 2-->
                    </shape>
                </transform>

                <transform translation="1.5, -1,-1.2">
                    <transform rotation='0 0 1 0.707'>
                        <shape DEF="hand">
                            <! --рука 1 -->
                            <Appearance>
                                <ImageTexture url='leg.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <Box size="0.4 6 0.4"></Box>
                        </shape>
                    </transform>
                </transform>

                <transform translation="1.5, -1,1.2">
                    <transform rotation='0 0 1 0.707'>
                        <shape USE="hand">
                            <! --рука 2 -->

                        </shape>
                    </transform>
                </transform>

                <transform DEF="block1" translation="2.5, -3,0" scale='0.5 0.5 0.5' transparency="0.5" rotation='0 0 1 1.7'>
                    <! -- Блок-->
                    <transform rotation="0 1 0 1.5708">
                        <Shape DEF="side">
                            <Appearance>
                                <ImageTexture url='gnd_side.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                            coordIndex="3 2 1 0 -1  "
                                            colorIndex="0 1 2 3 -1">
                                <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </transform>
                    <transform rotation="1 0 0 1.5708">
                        <transform translation="0,-2,2" rotation="0 1 0 1.5708">
                            <Shape USE="side">
                            </Shape>
                        </transform>
                    </transform>
                    <transform rotation="0 1 0 1.5708">
                        <transform translation="-2,-2,-0" rotation="0 0 1 -1.5708">
                            <Shape USE="side">
                            </Shape>
                        </transform>
                    </transform>
                    <transform translation="0,-4,0" rotation="0 1 0 1.5708">
                        <Shape USE="side">
                        </Shape>
                    </transform>
                    <transform translation="-2,-2,0" rotation="0 0 1 1.5708">
                        <Shape>
                            <Appearance>
                                <ImageTexture url='soil.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                            coordIndex="3 2 1 0 -1  "
                                            colorIndex="0 1 2 3 -1">
                                <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </transform>
                    <transform translation="2,-2,0" rotation="0 0 1 1.5708">
                        <Shape>
                            <Appearance>
                                <ImageTexture url='gnd_top.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                            coordIndex="3 2 1 0 -1  "
                                            colorIndex="0 1 2 3 -1">
                                <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </transform>
                    <Anchor url="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
                        <transform translation="0,-4,0" rotation="0 1 0 1.5708">
                            <Shape>
                                <Appearance>
                                    <ImageTexture url='naw.png'></ImageTexture>
                                    <TextureProperties></TextureProperties>
                                </Appearance>
                                <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                                coordIndex="3 2 1 0 -1  "
                                                colorIndex="0 1 2 3 -1">
                                    <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                                </IndexedFaceSet>
                            </Shape>
                        </transform>
                    </Anchor>
                </transform>


                <transform DEF="block1" translation="-2, -4.3,0" scale='0.8 0.8 0.8' transparency="0.5" rotation='0 0 1 1.55'>
                    <! -- Вагонетка-->
                    <transform rotation="0 1 0 1.5708" scale='1.8 1.8 1.0'>
                        <Shape DEF="side">
                            <Appearance>
                                <ImageTexture url='carlr.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                            coordIndex="3 2 1 0 -1  "
                                            colorIndex="0 1 2 3 -1">
                                <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </transform>
                    <transform rotation="1 0 0 1.5708">
                        <transform translation="0,-3.5,2" rotation="0 1 0 1.5708">
                            <Shape>
                                <Appearance>
                                    <ImageTexture url='carf.png'></ImageTexture>
                                    <TextureProperties></TextureProperties>
                                </Appearance>
                                <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                                coordIndex="3 2 1 0 -1  "
                                                colorIndex="0 1 2 3 -1">
                                    <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                                </IndexedFaceSet>
                            </Shape>
                        </transform>
                    </transform>
                    <transform rotation="0 1 0 1.5708">
                        <transform translation="-3.6,-2,-0" rotation="0 0 1 -1.5708">
                            <Shape>
                                <Appearance>
                                    <ImageTexture url='carf.png'></ImageTexture>
                                    <TextureProperties></TextureProperties>
                                </Appearance>
                                <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                                coordIndex="3 2 1 0 -1  "
                                                colorIndex="0 1 2 3 -1">
                                    <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                                </IndexedFaceSet>
                            </Shape>
                        </transform>
                    </transform>
                    <transform translation="0,-4,0" rotation="0 1 0 1.5708" scale='1.8 1.8 1.0'>
                        <Shape USE="side">
                        </Shape>
                    </transform>
                    <transform translation="-2,-2,0" rotation="0 0 1 1.5708">
                        <Shape>
                            <Appearance>
                                <ImageTexture url='carb.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                            coordIndex="3 2 1 0 -1  "
                                            colorIndex="0 1 2 3 -1">
                                <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </transform>
                    <transform translation="2,-2,0" rotation="0 0 1 1.5708" scale='1.0 1.8 1.8'>
                        <Shape>
                            <Appearance>
                                <ImageTexture url='cart.png'></ImageTexture>
                                <TextureProperties></TextureProperties>
                            </Appearance>
                            <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                            coordIndex="3 2 1 0 -1  "
                                            colorIndex="0 1 2 3 -1">
                                <Coordinate point="-2 0 2, 2 0 2, 2 0 -2, -2 0 -2"></Coordinate>
                            </IndexedFaceSet>
                        </Shape>
                    </transform>
                </transform>
            </transform>

            <! -- плоскость -->
            <transform translation="1,-6,-2" rotation="0 1 0 1.5708" scale='0.7 1.0 0.7'>
                <Shape>
                    <Appearance>
                        <ImageTexture url='plane2.png'></ImageTexture>
                        <TextureProperties></TextureProperties>
                    </Appearance>
                    <IndexedFaceSet ccw="true" colorPerVertex="true" convex="true" creaseAngle="0" normalPerVertex="true" solid="false"
                                    coordIndex="3 2 1 0 -1  "
                                    colorIndex="0 1 2 3 -1">
                        <Coordinate point="-40 0 40, 40 0 40, 40 0 -40, -40 0 -40"></Coordinate>
                    </IndexedFaceSet>
                </Shape>
            </transform>

            <TimeSensor DEF='TS' id="TS" cycleInterval='10' loop='true'></TimeSensor>
            <TimeSensor DEF='TS2' id="TS2" cycleInterval='0.7' loop='true'></TimeSensor>
            <OrientationInterpolator DEF='OI' key='0, 0.5, 1' keyValue='0 1 0 0, 0 1 0 3.14, 0 1 0 6.28'></OrientationInterpolator>
            <PositionInterpolator DEF='PI' key='0, 0.5, 1' keyValue='23 0.15 0 , 23 -0.1 0 , 23 0.15 0 '></PositionInterpolator>
            <OrientationChaser DEF="OrCh1" duration="5"></OrientationChaser>
            <ROUTE fromNode='TS' fromField='fraction_changed'
                   toNode='OI' toField='set_fraction'>
            </ROUTE>
            <ROUTE fromNode='OI' fromField='value_changed'
                   toNode='OrCh1' toField='set_destination'>
            </ROUTE>

            <Route fromNode="OrCh1" fromField="value_changed" 
                   toNode="ender" toField="set_rotation">
            </Route>
            <ROUTE fromNode='TS2' fromField='fraction_changed'
                   toNode='PI' toField='set_fraction'>
            </ROUTE>
            <ROUTE fromNode='PI' fromField='value_changed'
                   toNode='ender' toField='set_translation'>
            </ROUTE>


        </Scene>
  </X3D>
  </body> 
</html>
